<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ðŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
  const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
  const cityPoint = [];
  const ipt = document.getElementsByClassName('search')[0];
  const suggestions = document.getElementsByClassName('suggestions')[0];
  const xhr = new XMLHttpRequest();
  xhr.onreadystatechange = () => {
    if(xhr.readyState == 4) {
      if((xhr.status >= 200 && xhr.status <= 300) || xhr.status == 304) {
        const citys = JSON.parse(xhr.responseText).sort((a,b) => b.population - a.population);
        cityPoint.push(...citys);
        ipt.addEventListener('input',searchCity);
      }
    }
  }
  xhr.open('get',endpoint,true);
  xhr.send(null);
  function searchCity(e) {
    const lis = document.createDocumentFragment();
    const result = cityPoint.forEach(point => {
      const reg = new RegExp(e.target.value,'gi');
      const commasReg = /\B(?=(\d{3})+$)/g;
      if(reg.test(point.city) || reg.test(point.state)) {
        const name = `${point.city}, ${point.state}`.replace(reg,'<span class=\'hl\'>$&</span>');
        const li = document.createElement('li');
        li.innerHTML = `<span>${name}</span><span class='population'>${point.population.replace(commasReg,',')}</span>`;
        lis.appendChild(li);
      }
    });
    suggestions.innerHTML = '';
    suggestions.appendChild(lis);
  }
  //å¤ä¹ ä½¿ç”¨äº†åŽŸç”Ÿajaxå†™æ³•ï¼Œæ’å…¥æœç´¢ç»“æžœæ˜¯ç”¨documentFragmentå…ˆä¸€æ¡æ¡æ’å…¥liï¼Œæœ€åŽå†æ’å…¥åˆ°domä¸­æé«˜æ€§èƒ½ï¼Œè¦ä¸å¡å¾—ä¸èƒ½å¿ï¼Œç­”æ¡ˆç”¨å¾—æ˜¯å…¨å­—ç¬¦ä¸²æ‹¼æŽ¥ï¼Œæ„Ÿè§‰æ›´å¥½ç‚¹ã€‚
  //æ­£åˆ™è¡¨è¾¾å¼ä¸ç”¨å°±æ˜¯è®°ä¸ä½ï¼Œåˆå›žåŽ»çœ‹äº†éã€‚åœ¨ç½‘ä¸Šæ‰¾äº†ä¸¤ç§æ•ˆçŽ‡è¾ƒé«˜çš„åƒåˆ†åˆ¶è½¬åŒ–æ–¹æ³•ï¼š
  // function toThousands(num) {
  //     var result = '', counter = 0;
  //     num = (num || 0).toString();
  //     for (var i = num.length - 1; i >= 0; i--) {
  //         counter++;
  //         result = num.charAt(i) + result;
  //         if (!(counter % 3) && i != 0) { result = ',' + result; }
  //     }
  //     return result;
  // }
  // function toThousands(num) {
  //     var num = (num || 0).toString(), result = '';
  //     while (num.length > 3) {
  //         result = ',' + num.slice(-3) + result;
  //         num = num.slice(0, num.length - 3);
  //     }
  //     if (num) { result = num + result; }
  //     return result;
  // }
</script>
  </body>
</html>
